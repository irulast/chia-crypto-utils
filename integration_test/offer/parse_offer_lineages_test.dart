@Skip('Interacts with mainnet')
import 'dart:convert';

import 'package:chia_crypto_utils/chia_crypto_utils.dart';
import 'package:test/scaffolding.dart';

void main() {
  final fullNode = EnhancedChiaFullNodeInterface.fromUrl('FULL_NODE_URL');
  final keychain = WalletKeychain.fromCoreSecret(
    KeychainCoreSecret.fromMnemonicString(
      'MNEMONIC',
    ),
    walletSize: 100,
  );
  test('Should parse lineages from offer service', () async {
    final lineages = await OfferService.getLineagesFromOfferSpendBundle(
      spendBundle,
      fullNode,
    );

    final puzzlehashes = keychain.puzzlehashes.toSet();

    for (final lineage in lineages) {
      final originalDriver = await PuzzleDriver.matchAsync(
        lineage.originalParentSpend!.puzzleReveal,
      );

      if (originalDriver == null) {
        throw UnsupportedCoinException(lineage.originalParentSpend!);
      }

      final originP2Puzzlehash =
          originalDriver.getP2Puzzle(lineage.originalCoinSpend).hash();
      print(originP2Puzzlehash);
      if (!puzzlehashes.contains(originP2Puzzlehash)) {
        continue;
      }

      for (final p2Payment in await originalDriver.getP2PaymentsAsync(
        lineage.intermediateSpendWithAdditions.coinSpend,
      )) {
        print(p2Payment);
      }
    }
  });
}

final spendBundle = SpendBundle.fromJson(
  jsonDecode(
    '{"coin_spends":[{"coin":{"parent_coin_info":"0x94c15cf107e118742028fa67b9bbb874c5a73bab343c3d1217e23d197e512703","puzzle_hash":"0xcfbfdeed5c4ca2de3d0bf520b9cb4bb7743a359bd2e6a188d19ce7dffc21d3e7","amount":50000000000},"puzzle_reveal":"0xff02ffff01ff02ff0affff04ff02ffff04ff03ff80808080ffff04ffff01ffff333effff02ffff03ff05ffff01ff04ffff04ff0cffff04ffff02ff1effff04ff02ffff04ff09ff80808080ff808080ffff02ff16ffff04ff02ffff04ff19ffff04ffff02ff0affff04ff02ffff04ff0dff80808080ff808080808080ff8080ff0180ffff02ffff03ff05ffff01ff02ffff03ffff15ff29ff8080ffff01ff04ffff04ff08ff0980ffff02ff16ffff04ff02ffff04ff0dffff04ff0bff808080808080ffff01ff088080ff0180ffff010b80ff0180ff02ffff03ffff07ff0580ffff01ff0bffff0102ffff02ff1effff04ff02ffff04ff09ff80808080ffff02ff1effff04ff02ffff04ff0dff8080808080ffff01ff0bffff0101ff058080ff0180ff018080","solution":"0xffffa0706b3ca54e24d22d4aab3a9956f385e518a4faa7ceecc3d2d68515c1d77989ecffffa0c825e764b58ed5a2f7c6a486cdd038091c8e0eb8ca3d2341ce7fa400dd208d4cff850ba43b7400ff80808080"},{"coin":{"parent_coin_info":"0x1d68cbfbcafcb6fa90cd519bbd6e3b500eaf36606d0299ce2a0766cb5e3304c8","puzzle_hash":"0xdccf2eea4c2b3c2cb4c695db991e082fc72b04150120502261dcfa102ac39477","amount":3000},"puzzle_reveal":"0xff02ffff01ff02ffff01ff02ff5effff04ff02ffff04ffff04ff05ffff04ffff0bff34ff0580ffff04ff0bff80808080ffff04ffff02ff17ff2f80ffff04ff5fffff04ffff02ff2effff04ff02ffff04ff17ff80808080ffff04ffff02ff2affff04ff02ffff04ff82027fffff04ff82057fffff04ff820b7fff808080808080ffff04ff81bfffff04ff82017fffff04ff8202ffffff04ff8205ffffff04ff820bffff80808080808080808080808080ffff04ffff01ffffffff3d46ff02ff333cffff0401ff01ff81cb02ffffff20ff02ffff03ff05ffff01ff02ff32ffff04ff02ffff04ff0dffff04ffff0bff7cffff0bff34ff2480ffff0bff7cffff0bff7cffff0bff34ff2c80ff0980ffff0bff7cff0bffff0bff34ff8080808080ff8080808080ffff010b80ff0180ffff02ffff03ffff22ffff09ffff0dff0580ff2280ffff09ffff0dff0b80ff2280ffff15ff17ffff0181ff8080ffff01ff0bff05ff0bff1780ffff01ff088080ff0180ffff02ffff03ff0bffff01ff02ffff03ffff09ffff02ff2effff04ff02ffff04ff13ff80808080ff820b9f80ffff01ff02ff56ffff04ff02ffff04ffff02ff13ffff04ff5fffff04ff17ffff04ff2fffff04ff81bfffff04ff82017fffff04ff1bff8080808080808080ffff04ff82017fff8080808080ffff01ff088080ff0180ffff01ff02ffff03ff17ffff01ff02ffff03ffff20ff81bf80ffff0182017fffff01ff088080ff0180ffff01ff088080ff018080ff0180ff04ffff04ff05ff2780ffff04ffff10ff0bff5780ff778080ffffff02ffff03ff05ffff01ff02ffff03ffff09ffff02ffff03ffff09ff11ff5880ffff0159ff8080ff0180ffff01818f80ffff01ff02ff26ffff04ff02ffff04ff0dffff04ff0bffff04ffff04ff81b9ff82017980ff808080808080ffff01ff02ff7affff04ff02ffff04ffff02ffff03ffff09ff11ff5880ffff01ff04ff58ffff04ffff02ff76ffff04ff02ffff04ff13ffff04ff29ffff04ffff0bff34ff5b80ffff04ff2bff80808080808080ff398080ffff01ff02ffff03ffff09ff11ff7880ffff01ff02ffff03ffff20ffff02ffff03ffff09ffff0121ffff0dff298080ffff01ff02ffff03ffff09ffff0cff29ff80ff3480ff5c80ffff01ff0101ff8080ff0180ff8080ff018080ffff0109ffff01ff088080ff0180ffff010980ff018080ff0180ffff04ffff02ffff03ffff09ff11ff5880ffff0159ff8080ff0180ffff04ffff02ff26ffff04ff02ffff04ff0dffff04ff0bffff04ff17ff808080808080ff80808080808080ff0180ffff01ff04ff80ffff04ff80ff17808080ff0180ffff02ffff03ff05ffff01ff04ff09ffff02ff56ffff04ff02ffff04ff0dffff04ff0bff808080808080ffff010b80ff0180ff0bff7cffff0bff34ff2880ffff0bff7cffff0bff7cffff0bff34ff2c80ff0580ffff0bff7cffff02ff32ffff04ff02ffff04ff07ffff04ffff0bff34ff3480ff8080808080ffff0bff34ff8080808080ffff02ffff03ffff07ff0580ffff01ff0bffff0102ffff02ff2effff04ff02ffff04ff09ff80808080ffff02ff2effff04ff02ffff04ff0dff8080808080ffff01ff0bffff0101ff058080ff0180ffff04ffff04ff30ffff04ff5fff808080ffff02ff7effff04ff02ffff04ffff04ffff04ff2fff0580ffff04ff5fff82017f8080ffff04ffff02ff26ffff04ff02ffff04ff0bffff04ff05ffff01ff808080808080ffff04ff17ffff04ff81bfffff04ff82017fffff04ffff02ff2affff04ff02ffff04ff8204ffffff04ffff02ff76ffff04ff02ffff04ff09ffff04ff820affffff04ffff0bff34ff2d80ffff04ff15ff80808080808080ffff04ff8216ffff808080808080ffff04ff8205ffffff04ff820bffff808080808080808080808080ff02ff5affff04ff02ffff04ff5fffff04ff3bffff04ffff02ffff03ff17ffff01ff09ff2dffff02ff2affff04ff02ffff04ff27ffff04ffff02ff76ffff04ff02ffff04ff29ffff04ff57ffff04ffff0bff34ff81b980ffff04ff59ff80808080808080ffff04ff81b7ff80808080808080ff8080ff0180ffff04ff17ffff04ff05ffff04ff8202ffffff04ffff04ffff04ff78ffff04ffff0eff5cffff02ff2effff04ff02ffff04ffff04ff2fffff04ff82017fff808080ff8080808080ff808080ffff04ffff04ff20ffff04ffff0bff81bfff5cffff02ff2effff04ff02ffff04ffff04ff15ffff04ffff10ff82017fffff11ff8202dfff2b80ff8202ff80ff808080ff8080808080ff808080ff138080ff80808080808080808080ff018080ffff04ffff01a037bef360ee858133b69d595a906dc45d01af50379dad515eb9518abb7c1d2a7affff04ffff01a06d95dae356e32a71db5ddcb42224754a02524c615c5fc35f568c2af04774e589ffff04ffff01ff02ffff01ff02ff0affff04ff02ffff04ff03ff80808080ffff04ffff01ffff333effff02ffff03ff05ffff01ff04ffff04ff0cffff04ffff02ff1effff04ff02ffff04ff09ff80808080ff808080ffff02ff16ffff04ff02ffff04ff19ffff04ffff02ff0affff04ff02ffff04ff0dff80808080ff808080808080ff8080ff0180ffff02ffff03ff05ffff01ff02ffff03ffff15ff29ff8080ffff01ff04ffff04ff08ff0980ffff02ff16ffff04ff02ffff04ff0dffff04ff0bff808080808080ffff01ff088080ff0180ffff010b80ff0180ff02ffff03ffff07ff0580ffff01ff0bffff0102ffff02ff1effff04ff02ffff04ff09ff80808080ffff02ff1effff04ff02ffff04ff0dff8080808080ffff01ff0bffff0101ff058080ff0180ff018080ff0180808080","solution":"0xffffffa0be77a0973b5830f15fa9aa080b96e114a188265cb617dcc570936a59488546a4ffffa0a223fe8509020d0c73649b2f70dea670230ff1ad1e82c17f6291e110ad07b0feff820bb8ffffa0a223fe8509020d0c73649b2f70dea670230ff1ad1e82c17f6291e110ad07b0fe80808080ffffa0aff9139c7faf6e166e7d654a811ab4278dc63fa04a0a73f7fda844180287c603ffa0c58f5a9fcdb3c0679aa8c3cdc6d870270e2a50463abf59dbd2459de5c196b75cff8210cc80ffa0f1158b0de9b5092f29a70810deefc7209021744b44df1d56c03c7b75e0eac183ffffa01d68cbfbcafcb6fa90cd519bbd6e3b500eaf36606d0299ce2a0766cb5e3304c8ffa0dccf2eea4c2b3c2cb4c695db991e082fc72b04150120502261dcfa102ac39477ff820bb880ffffa01d68cbfbcafcb6fa90cd519bbd6e3b500eaf36606d0299ce2a0766cb5e3304c8ffa0cfbfdeed5c4ca2de3d0bf520b9cb4bb7743a359bd2e6a188d19ce7dffc21d3e7ff820bb880ff80ff8080"},{"coin":{"parent_coin_info":"0xeebdc6e5f85fda8a72afabe9aa1d05cdd6bf8ceec2c6c1be73f5dc0a9038bd08","puzzle_hash":"0xa223fe8509020d0c73649b2f70dea670230ff1ad1e82c17f6291e110ad07b0fe","amount":479663653804},"puzzle_reveal":"0xff02ffff01ff02ffff01ff02ffff03ff0bffff01ff02ffff03ffff09ff05ffff1dff0bffff1effff0bff0bffff02ff06ffff04ff02ffff04ff17ff8080808080808080ffff01ff02ff17ff2f80ffff01ff088080ff0180ffff01ff04ffff04ff04ffff04ff05ffff04ffff02ff06ffff04ff02ffff04ff17ff80808080ff80808080ffff02ff17ff2f808080ff0180ffff04ffff01ff32ff02ffff03ffff07ff0580ffff01ff0bffff0102ffff02ff06ffff04ff02ffff04ff09ff80808080ffff02ff06ffff04ff02ffff04ff0dff8080808080ffff01ff0bffff0101ff058080ff0180ff018080ffff04ffff01b0a471ccaf0087b49b869b8aa2129995cec2e086bfb97f155b2e380eb7c323425708106718ed1eabc9ceafff142b9826c2ff018080","solution":"0xff80ffff01ffff33ffa0cfbfdeed5c4ca2de3d0bf520b9cb4bb7743a359bd2e6a188d19ce7dffc21d3e7ff850ba43b740080ffff33ffa0a223fe8509020d0c73649b2f70dea670230ff1ad1e82c17f6291e110ad07b0feff856409f30fac80ffff3fffa04030a73cafac38e4f52dbe001a0d446c737ad128b1a820969ab3fc31fd8b6fc980ffff3cffa06057f700e375ac3795d9fcf6b360e3030949b6acf27404e2264bdbc0a36f98618080ff8080"},{"coin":{"parent_coin_info":"0xaff9139c7faf6e166e7d654a811ab4278dc63fa04a0a73f7fda844180287c603","puzzle_hash":"0xc3cce10724b14ce00180478ddf8806d223d5efb95e1157cc6109c695593a36e8","amount":4300},"puzzle_reveal":"0xff02ffff01ff02ffff01ff02ff5effff04ff02ffff04ffff04ff05ffff04ffff0bff34ff0580ffff04ff0bff80808080ffff04ffff02ff17ff2f80ffff04ff5fffff04ffff02ff2effff04ff02ffff04ff17ff80808080ffff04ffff02ff2affff04ff02ffff04ff82027fffff04ff82057fffff04ff820b7fff808080808080ffff04ff81bfffff04ff82017fffff04ff8202ffffff04ff8205ffffff04ff820bffff80808080808080808080808080ffff04ffff01ffffffff3d46ff02ff333cffff0401ff01ff81cb02ffffff20ff02ffff03ff05ffff01ff02ff32ffff04ff02ffff04ff0dffff04ffff0bff7cffff0bff34ff2480ffff0bff7cffff0bff7cffff0bff34ff2c80ff0980ffff0bff7cff0bffff0bff34ff8080808080ff8080808080ffff010b80ff0180ffff02ffff03ffff22ffff09ffff0dff0580ff2280ffff09ffff0dff0b80ff2280ffff15ff17ffff0181ff8080ffff01ff0bff05ff0bff1780ffff01ff088080ff0180ffff02ffff03ff0bffff01ff02ffff03ffff09ffff02ff2effff04ff02ffff04ff13ff80808080ff820b9f80ffff01ff02ff56ffff04ff02ffff04ffff02ff13ffff04ff5fffff04ff17ffff04ff2fffff04ff81bfffff04ff82017fffff04ff1bff8080808080808080ffff04ff82017fff8080808080ffff01ff088080ff0180ffff01ff02ffff03ff17ffff01ff02ffff03ffff20ff81bf80ffff0182017fffff01ff088080ff0180ffff01ff088080ff018080ff0180ff04ffff04ff05ff2780ffff04ffff10ff0bff5780ff778080ffffff02ffff03ff05ffff01ff02ffff03ffff09ffff02ffff03ffff09ff11ff5880ffff0159ff8080ff0180ffff01818f80ffff01ff02ff26ffff04ff02ffff04ff0dffff04ff0bffff04ffff04ff81b9ff82017980ff808080808080ffff01ff02ff7affff04ff02ffff04ffff02ffff03ffff09ff11ff5880ffff01ff04ff58ffff04ffff02ff76ffff04ff02ffff04ff13ffff04ff29ffff04ffff0bff34ff5b80ffff04ff2bff80808080808080ff398080ffff01ff02ffff03ffff09ff11ff7880ffff01ff02ffff03ffff20ffff02ffff03ffff09ffff0121ffff0dff298080ffff01ff02ffff03ffff09ffff0cff29ff80ff3480ff5c80ffff01ff0101ff8080ff0180ff8080ff018080ffff0109ffff01ff088080ff0180ffff010980ff018080ff0180ffff04ffff02ffff03ffff09ff11ff5880ffff0159ff8080ff0180ffff04ffff02ff26ffff04ff02ffff04ff0dffff04ff0bffff04ff17ff808080808080ff80808080808080ff0180ffff01ff04ff80ffff04ff80ff17808080ff0180ffff02ffff03ff05ffff01ff04ff09ffff02ff56ffff04ff02ffff04ff0dffff04ff0bff808080808080ffff010b80ff0180ff0bff7cffff0bff34ff2880ffff0bff7cffff0bff7cffff0bff34ff2c80ff0580ffff0bff7cffff02ff32ffff04ff02ffff04ff07ffff04ffff0bff34ff3480ff8080808080ffff0bff34ff8080808080ffff02ffff03ffff07ff0580ffff01ff0bffff0102ffff02ff2effff04ff02ffff04ff09ff80808080ffff02ff2effff04ff02ffff04ff0dff8080808080ffff01ff0bffff0101ff058080ff0180ffff04ffff04ff30ffff04ff5fff808080ffff02ff7effff04ff02ffff04ffff04ffff04ff2fff0580ffff04ff5fff82017f8080ffff04ffff02ff26ffff04ff02ffff04ff0bffff04ff05ffff01ff808080808080ffff04ff17ffff04ff81bfffff04ff82017fffff04ffff02ff2affff04ff02ffff04ff8204ffffff04ffff02ff76ffff04ff02ffff04ff09ffff04ff820affffff04ffff0bff34ff2d80ffff04ff15ff80808080808080ffff04ff8216ffff808080808080ffff04ff8205ffffff04ff820bffff808080808080808080808080ff02ff5affff04ff02ffff04ff5fffff04ff3bffff04ffff02ffff03ff17ffff01ff09ff2dffff02ff2affff04ff02ffff04ff27ffff04ffff02ff76ffff04ff02ffff04ff29ffff04ff57ffff04ffff0bff34ff81b980ffff04ff59ff80808080808080ffff04ff81b7ff80808080808080ff8080ff0180ffff04ff17ffff04ff05ffff04ff8202ffffff04ffff04ffff04ff78ffff04ffff0eff5cffff02ff2effff04ff02ffff04ffff04ff2fffff04ff82017fff808080ff8080808080ff808080ffff04ffff04ff20ffff04ffff0bff81bfff5cffff02ff2effff04ff02ffff04ffff04ff15ffff04ffff10ff82017fffff11ff8202dfff2b80ff8202ff80ff808080ff8080808080ff808080ff138080ff80808080808080808080ff018080ffff04ffff01a037bef360ee858133b69d595a906dc45d01af50379dad515eb9518abb7c1d2a7affff04ffff01a06d95dae356e32a71db5ddcb42224754a02524c615c5fc35f568c2af04774e589ffff04ffff01ff02ffff01ff02ffff01ff02ffff03ff0bffff01ff02ffff03ffff09ff05ffff1dff0bffff1effff0bff0bffff02ff06ffff04ff02ffff04ff17ff8080808080808080ffff01ff02ff17ff2f80ffff01ff088080ff0180ffff01ff04ffff04ff04ffff04ff05ffff04ffff02ff06ffff04ff02ffff04ff17ff80808080ff80808080ffff02ff17ff2f808080ff0180ffff04ffff01ff32ff02ffff03ffff07ff0580ffff01ff0bffff0102ffff02ff06ffff04ff02ffff04ff09ff80808080ffff02ff06ffff04ff02ffff04ff0dff8080808080ffff01ff0bffff0101ff058080ff0180ff018080ffff04ffff01b083ceffb3609d4d793c73b048aba7873fc1cc31cabfdbb88c6497ebbc328c54370d156bf408b91c60cdfc2d0786fffdf5ff018080ff0180808080","solution":"0xffff80ffff01ffff3cffa079763e77e9b82b74b044a842d636c453ba8273a91e5d2aacda791c571d0633d180ffff3fffa0a22f7325c1f58fcf32989692b5f30c99d31ed961f10c3e52589be8c78ed70bf780ffff33ffa0cfbfdeed5c4ca2de3d0bf520b9cb4bb7743a359bd2e6a188d19ce7dffc21d3e7ff820bb8ffffa0cfbfdeed5c4ca2de3d0bf520b9cb4bb7743a359bd2e6a188d19ce7dffc21d3e78080ffff33ffa0d0499bf725963fe8428152f09c317b1c7591c1f8fd1f3d199a09f26ddada6d45ff820514ffffa0d0499bf725963fe8428152f09c317b1c7591c1f8fd1f3d199a09f26ddada6d45808080ff8080ffffa05c463d3b9437c65f73941fa65ecef002f68657368979e6bee04af58936c4f3ccffa0cfbfdeed5c4ca2de3d0bf520b9cb4bb7743a359bd2e6a188d19ce7dffc21d3e7ff8210cc80ffa01d68cbfbcafcb6fa90cd519bbd6e3b500eaf36606d0299ce2a0766cb5e3304c8ffffa0aff9139c7faf6e166e7d654a811ab4278dc63fa04a0a73f7fda844180287c603ffa0c3cce10724b14ce00180478ddf8806d223d5efb95e1157cc6109c695593a36e8ff8210cc80ffffa0aff9139c7faf6e166e7d654a811ab4278dc63fa04a0a73f7fda844180287c603ffa0c58f5a9fcdb3c0679aa8c3cdc6d870270e2a50463abf59dbd2459de5c196b75cff8210cc80ff80ff8080"},{"coin":{"parent_coin_info":"0xce782782e8ff84a1d3dd62bda3420a119f167dc46f99854b210cb949e3fa4eb3","puzzle_hash":"0xa722467d4b9414aaef9b8b3d8b9c545f542519a661430e6d6b11c0eb5dcfebbc","amount":9999999950},"puzzle_reveal":"0xff02ffff01ff02ffff01ff02ffff03ff0bffff01ff02ffff03ffff09ff05ffff1dff0bffff1effff0bff0bffff02ff06ffff04ff02ffff04ff17ff8080808080808080ffff01ff02ff17ff2f80ffff01ff088080ff0180ffff01ff04ffff04ff04ffff04ff05ffff04ffff02ff06ffff04ff02ffff04ff17ff80808080ff80808080ffff02ff17ff2f808080ff0180ffff04ffff01ff32ff02ffff03ffff07ff0580ffff01ff0bffff0102ffff02ff06ffff04ff02ffff04ff09ff80808080ffff02ff06ffff04ff02ffff04ff0dff8080808080ffff01ff0bffff0101ff058080ff0180ff018080ffff04ffff01b08d1e252e78a96dfc55ff51262ba516472acb8c3a9e281d4dbe5921c607811dd978c34b1585a27bb59eb4aaac7c69c4aeff018080","solution":"0xff80ffff01ffff33ffa0d0499bf725963fe8428152f09c317b1c7591c1f8fd1f3d199a09f26ddada6d45ff8502540be39c80ffff34ff3280ffff3fffa0a22f7325c1f58fcf32989692b5f30c99d31ed961f10c3e52589be8c78ed70bf780ffff3cffa05129c2e18c9ab2fb9ab59e25f245be326dab7df95e7c0ffd223b8cb51f23305b8080ff8080"}],"aggregated_signature":"0xb4bd3b4129700ce5c750cdbe31d58aad18861d7aa224110cbfcdb65728d2dc063cb764c10c6b82cf1a50e34d4bd2f721108e8fc5cf1978dfe31bc0d33a5eb6a636f10bb449061a35c2f45f8071e93d30cf7b9fe166e5a2d4fc5d1491ec605684"}',
  ) as Map<String, dynamic>,
);
